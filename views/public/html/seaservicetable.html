<!DOCTYPE html>

<html
  lang="en"
  class="light-style layout-menu-fixed"
  dir="ltr"
  data-theme="theme-default"
  data-assets-path="../assets/"
  data-template="vertical-menu-template-free"
>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <style>
      .loader {
        --r1: 154%;
        --r2: 68.5%;
        width: 60px;
        aspect-ratio: 1;
        border-radius: 50%;
        background: radial-gradient(
            var(--r1) var(--r2) at top,
            #0000 79.5%,
            #269af2 80%
          ),
          radial-gradient(
            var(--r1) var(--r2) at bottom,
            #269af2 79.5%,
            #0000 80%
          ),
          radial-gradient(var(--r1) var(--r2) at top, #0000 79.5%, #269af2 80%),
          #ccc;
        background-size: 50.5% 220%;
        background-position: -100% 0%, 0% 0%, 100% 0%;
        background-repeat: no-repeat;
        animation: l9 1.4s linear forwards;
        animation-iteration-count: 1;
        animation-fill-mode: forwards;
      }

      @keyframes l9 {
        33% {
          background-position: 0% 33%, 100% 33%, 200% 33%;
        }
        66% {
          background-position: -100% 66%, 0% 66%, 100% 66%;
        }
        100% {
          background-position: 0% 100%, 100% 100%, 200% 100%;
        }
      }
      .select2 {
        width: 100% !important;
        height: 50px;
      }
      .select2-selection  {
        height: 41px !important;
        padding-top: 5px !important;
      }
    </style>
    <title>Sea Service | Nsnemo</title>

    <meta name="description" content="" />
    <link rel="icon" type="image/x-icon" href="./fav-icon.ico" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Company - Nsnemo</title>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../assets/sweetalert/sweetalert2.min.css" />

    <!-- Icons. Uncomment required icon fonts -->
    <link rel="stylesheet" href="../assets/vendor/fonts/boxicons.css" />

    <!-- Core CSS -->
    <link
      rel="stylesheet"
      href="../assets/vendor/css/core.css"
      class="template-customizer-core-css"
    />
    <link
      rel="stylesheet"
      href="../assets/vendor/css/theme-default.css"
      class="template-customizer-theme-css"
    />
    <link rel="stylesheet" href="../assets/css/demo.css" />

    <!-- Vendors CSS -->
    <link
      rel="stylesheet"
      href="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css"
    />

    <!-- Page CSS -->

    <!-- Helpers -->
    <script src="../assets/vendor/js/helpers.js"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="../assets/js/config.js"></script>
  </head>

  <body>
    <div id="logoutContent"></div>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->

        <aside
          id="layout-menu"
          class="layout-menu menu-vertical menu bg-menu-theme"
        >
          <div
            class="app-brand demo mt-0"
            style="
              background-color: #008e9c;
              padding-top: 70px;
              padding-bottom: 50px;
            "
            id="leftLogo"
          ></div>

          <ul class="menu-inner py-1 pt-3" id="menuList"></ul>
        </aside>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->

          <nav
            class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
            id="layout-navbar"
          ></nav>

          <!-- / Navbar -->

          <!-- Content wrapper -->
          <div class="container-fluid p-3">
            <div class="btn-group">
              <button
                type="button"
                class="btn btn-primary dropdown-toggle hide-arrow"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                â‰¡ EDIT CANDIDATE
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" id="personal">> PERSONAL</a></li>
                <li>
                  <a class="dropdown-item" id="discussion">> DISCUSSION</a>
                </li>
                <li><a class="dropdown-item" id="contract">> CONTRACT</a></li>
                <li><a class="dropdown-item" id="document">> DOCUMENT</a></li>
                <li><a class="dropdown-item" id="bank">> BANK</a></li>
                <li><a class="dropdown-item" id="travel">> TRAVEL</a></li>
                <li><a class="dropdown-item" id="medicals">> MEDICALS</a></li>
                <li><a class="dropdown-item" id="nkd">> NKD</a></li>
                <li>
                  <a class="dropdown-item" id="seaservice">> SEASERVICE</a>
                </li>
              </ul>
            </div>

            <div id="seaServiceContent">
              <div class="content-wrapper rounded-3">
                <div class="w-100">
                  <div class="d-flex justify-content-end">
                    <a
                      class="btn btn-danger text-white m-3"
                      id="goback"
                      onclick="goBack()"
                      >Go Back to View Candidate Page</a
                    >
                  </div>
                  <div class="">
                    <h4
                      class="text-center mt-3 mb-0 rounded-0 shadow-none border border-dark card p-3"
                    >
                      Sea Service Records
                    </h4>

                    <div class="table-responsive text-center text-nowrap">
                      <table
                        id="seaServiceTable"
                        class="table table table-striped table-bordered"
                        style="font-size: 12px"
                      >
                        <thead>
                          <tr>
                            <th scope="col">S.No.</th>
                            <th scope="col">From</th>
                            <th scope="col">To</th>
                            <th scope="col">Company</th>
                            <th scope="col">Rank</th>
                            <th scope="col">Vessel</th>
                            <th scope="col">Flag</th>
                            <th scope="col">KWT</th>
                            <th scope="col">GRT</th>
                            <th scope="col">DWT</th>
                            <th scope="col">Engine</th>
                            <th scope="col">Vessel Type</th>
                            <th scope="col">Total MMDD</th>
                            <th scope="col">Reason for Sign Off</th>
                            <th scope="col">Actions</th>
                          </tr>
                        </thead>
                        <tbody id="seaServiceList">
                          <!-- Sea service records will be dynamically added here -->
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="accordion" id="seaServiceAccordion">
              <div class="accordion-item">
                <h2 class="accordion-header" id="seaServiceHeading">
                  <button
                    class="accordion-button"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#seaServiceCollapse"
                    aria-expanded="true"
                    aria-controls="seaServiceCollapse"
                  >
                    Click here to Add Sea Service
                  </button>
                </h2>
                <form id="seaServiceForm">
                  <div
                    id="seaServiceCollapse"
                    class="accordion-collapse collapse"
                    aria-labelledby="seaServiceHeading"
                    data-bs-parent="#seaServiceAccordion"
                  >
                    <div class="accordion-body">
                      
                      <div class="row mt-3">
                        <div class="col-md-6">
                          <label for="company" class="form-label">Company<span class="error">*</span></label>
                          <select class="form-control select-dropdown" id="company" required>
                            <option value="" disabled selected>
                              -- Select Company --
                            </option>
                          </select>
                        </div>
                        <div class="col-md-6" style="display: none;" id="othercompany">
                          <label for="other_company" class="form-label">Other Company<span class="error">*</span></label>
                          <input
                            type="text"
                            class="form-control"
                            id="other_company"
                          />
                        </div>
                        <div class="col-md-6">
                          <label for="rank" class="form-label">Rank<span class="error">*</span></label>
                          <select class="form-control select-dropdown" id="rank" required>
                            <option value="" disabled selected>
                              -- Select Rank --
                            </option>
                          </select>
                        </div>
                        <div class="col-md-6" style="display: none;" id="otherrank">
                          <label for="other_rank" class="form-label">Other Rank<span class="error">*</span></label>
                          <input
                            type="text"
                            class="form-control"
                            id="other_rank"
                          />
                        </div>
                        <div class="col-md-6">
                          <label for="vessel" class="form-label">Vessel<span class="error">*</span></label>
                          <select class="form-control select-dropdown" id="vessel" required>
                            <option value="" disabled selected>
                              -- Select Vessel --
                            </option>
                          </select>
                        </div>
                        <div class="col-md-6" style="display: none;" id="othervessel">
                          <label for="other_vessel" class="form-label">Other Vessel<span class="error">*</span></label>
                          <input
                            type="text"
                            class="form-control"
                            id="other_vessel"
                          />
                        </div>
                        <div class="col-md-6">
                          <label for="type" class="form-label">Vessel Type<span class="error">*</span></label>
                          <select class="form-control select-dropdown" id="type" required>
                            <option value="" disabled selected>
                              -- Select Vessel Type --
                            </option>
                          </select>
                        </div>
                        <div class="col-md-6" style="display: none;" id="othervesseltype">
                          <label for="other_vesseltype" class="form-label">Other Vessel Type<span class="error">*</span></label>
                          <input
                            type="text"
                            class="form-control"
                            id="other_vesseltype"
                          />
                        </div>
                        <div class="col-md-6">
                          <label for="Flag" class="form-label">Flag</label>
                          <input
                            type="text"
                            class="form-control"
                            id="Flag"
                            required
                          />
                        </div>
                        <div class="col-md-6">
                          <label for="KWT" class="form-label">KWT</label>
                          <input
                            type="text"
                            class="form-control"
                            id="KWT"
                            required
                          />
                        </div>
                        <div class="col-md-6">
                          <label for="GRT" class="form-label">GRT</label>
                          <input
                            type="text"
                            class="form-control"
                            id="GRT"
                            required
                          />
                        </div>
                        <div class="col-md-6">
                          <label for="DWT" class="form-label">DWT</label>
                          <input
                            type="text"
                            class="form-control"
                            id="DWT"
                            required
                          />
                        </div>
                        <div class="col-md-6">
                          <label for="Engine" class="form-label">Engine</label>
                          <input
                            type="text"
                            class="form-control"
                            id="Engine"
                            required
                          />
                        </div>
                        <div class="col-md-3">
                          <label for="from1" class="form-label">From</label>
                          <input
                            type="date"
                            class="form-control"
                            id="from1"
                            required
                          />
                        </div>
                        <div class="col-md-3">
                          <label for="to1" class="form-label">To</label>
                          <input
                            type="date"
                            class="form-control"
                            id="to1"
                            required
                          />
                        </div>
                        <div class="col-md-6">
                          <label for="total_MMDD" class="form-label"
                            >Total MMDD</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="total_MMDD"
                            required
                          />
                        </div>
                        <div class="col-md-6">
                          <label for="reason_for_sign_off" class="form-label"
                            >Reason for Sign Off</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="reason_for_sign_off"
                            required
                          />
                        </div>
                        <div class="col-md-6">
                          <label for="createdBy" class="form-label"
                            >Created By</label
                          >
                          <input
                            type="hidden"
                            class="form-control"
                            id="createdBy"
                            required
                          />
                        </div>
                      </div>
                    </div>
                    <div class="row mt-4">
                      <div class="col-md-6">
                        <input type="hidden" id="editID" />
                        <button type="submit" class="btn btn-primary">
                          Submit Sea Service
                        </button>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
            <footer
              class="footer mt-auto py-3 bg-footer-theme"
              id="footetcontent"
            ></footer>
          </div>
        </div>
      </div>
    </div>

    <!-- / Layout wrapper -->

    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->
    <script src="../assets/vendor/libs/jquery/jquery.js"></script>
    <script src="../assets/vendor/libs/popper/popper.js"></script>
    <script src="../assets/vendor/js/bootstrap.js"></script>
    <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script src="../assets/vendor/js/menu.js"></script>
    <!-- endbuild -->

    <!-- Vendors JS -->
    <script>
      let activeMenu = "candidate";
      let activesub = "viewcandidate";
      let currentPage = "Candidate";
    </script>
    <script src="./menu.js"></script>

    <!-- Main JS -->
    <script src="../assets/js/main.js"></script>
    <!-- <script src ="./edit-vessel.js"></script> -->
    <!-- Page JS -->
    <script src="../assets/js/pages-account-settings-account.js"></script>

    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script src="../assets/sweetalert/sweetalert2.min.js"></script>
    <script>
      const urlParams = new URLSearchParams(window.location.search);
      // Get the candidateId from the URL parameter
      const id = urlParams.get("memId");
      document.addEventListener("DOMContentLoaded", async function (e) {
        e.preventDefault();
        

        await fetchAndDisplaySeaService(id);
        let dropdownItems = document.querySelectorAll(".dropdown-item");

        // Add click event listener to each dropdown item
        dropdownItems.forEach(function (item) {
          item.addEventListener("click", function () {
            // Get the id attribute of the clicked item
            var itemId = item.id;
            const urlParams = new URLSearchParams(window.location.search);

            // Get the candidateId from the URL parameter
            const memId = urlParams.get("memId");
            // Define the destination URLs based on the clicked item
            var destinationPage = "";
            switch (itemId) {
              case "personal":
                destinationPage = `./edit-candidate-2.html?memId=${memId}`;
                break;
              case "discussion":
                destinationPage = `./edit-discussion.html?memId=${memId}`;
                break;
              case "contract":
                destinationPage = `./add-c-contract.html?memId=${memId}`;
                break;
              case "document":
                destinationPage = `./add-c-document.html?memId=${memId}`;
                break;
              case "bank":
                destinationPage = `./add-c-bank.html?memId=${memId}`;
                break;
              case "travel":
                destinationPage = `./add-c-travel.html?memId=${memId}`;
                break;
              case "medicals":
                destinationPage = `./add-c-medicals.html?memId=${memId}`;
                break;
              case "nkd":
                destinationPage = `./add-c-nkd.html?memId=${memId}`;
                break;
              case "seaservice":
                destinationPage = `./seaservicetable.html?memId=${memId};`;
                break;
              default:
                // Handle default case or do nothing
                break;
            }

            // Redirect to the destination pageÂ¯
            if (destinationPage !== "") {
              window.location.href = destinationPage;
            }
          });
        });
      });
      const month = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
      function formatDateNew(dateString) {
        if (dateString === "1970-01-01" || dateString === "01-01-1970") {
          return ""; // Return empty string for invalid dates
        }
        dateString = new Date(dateString);
        dateString = addFrontZero(dateString.getDate())+'-'+month[dateString.getMonth()]+'-'+dateString.getFullYear()
        return `${dateString}`;
      }
      function addFrontZero(value) {
        if(value!=="") {
          if(parseInt(value)<10) {
              return '0'+value;
          }else {
            return value;
          }
        }
      }
      var companyList = [];
      async function fetchAndDisplayCompanies() {
        try {
          const companyResponse = await axios.get(
            `${config.APIURL}company/dropdown-company`,
            {
              headers: { Authorization: token },
            }
          );
          const companies = companyResponse.data.companies;
          const companySelect = document.getElementById("company");

          companySelect.innerHTML =
            '<option value="" disabled selected>-- Select Company --</option>';

          companies.forEach((company) => {
            const option = document.createElement("option");
            option.value = company.company_name;
            option.textContent = company.company_name;
            companySelect.appendChild(option);
            companyList.push(company.company_name);
          });
          const optionother = document.createElement("option");
          optionother.value = 'Others';
          optionother.textContent = 'Others';
          companySelect.appendChild(optionother);
        } catch (error) {
          console.error("Error fetching and displaying companies:", error);
        }
      }
      var rankList = [];
      async function fetchAndDisplayRanks() {
        try {
          const rankResponse = await axios.get(
            `${config.APIURL}others/get-ranks`,
            {
              headers: { Authorization: token },
            }
          );
          const ranks = rankResponse.data.ranks;
          const rankSelect = document.getElementById("rank");

          rankSelect.innerHTML =
            '<option value="" disabled selected>-- Select Rank --</option>';

          ranks.forEach((rank) => {
            const option = document.createElement("option");
            option.value = rank.rank;
            option.textContent = rank.rank;
            rankSelect.appendChild(option);
            rankList.push(rank.rank)
          });
          const optionother = document.createElement("option");
          optionother.value = 'Others';
          optionother.textContent = 'Others';
          rankSelect.appendChild(optionother);
        } catch (error) {
          console.error("Error fetching and displaying ranks:", error);
        }
      }
      var vesselTypeList = [];
      
      async function fetchAndDisplayVessels() {
        try {
          const vesselResponse = await axios.get(
            `${config.APIURL}others/get-vessel`,
            {
              headers: { Authorization: token },
            }
          );
          const vessels = vesselResponse.data.vessels;
          const vesselSelect = document.getElementById("type");

          vesselSelect.innerHTML =
            '<option value="" disabled selected>-- Select Vessel Type --</option>';

          vessels.forEach((vessel) => {
            const option = document.createElement("option");
            option.value = vessel.vesselName;
            option.textContent = vessel.vesselName;
            vesselSelect.appendChild(option);
            vesselTypeList.push(vessel.vesselName)
          });
          const optionother = document.createElement("option");
          optionother.value = 'Others';
          optionother.textContent = 'Others';
          vesselSelect.appendChild(optionother);
        } catch (error) {
          console.error("Error fetching and displaying vessels:", error);
        }
      }
      var vesselList = [];
      async function fetchAndDisplayVesselTypes() {
        try {
          const vesselTypeResponse = await axios.get(
            `${config.APIURL}others/get-vsls`,
            {
              headers: { Authorization: token },
            }
          );
          const vesselTypes = vesselTypeResponse.data.vessels;
          const typeSelect = document.getElementById("vessel");

          typeSelect.innerHTML =
            '<option value="" disabled selected>-- Select Veseel --</option>';

          vesselTypes.forEach((vesselType) => {
            const option = document.createElement("option");
            option.value = vesselType.vesselName;
            option.textContent = vesselType.vesselName;
            typeSelect.appendChild(option);
            vesselList.push(vesselType.vesselName)
          });
          const optionother = document.createElement("option");
          optionother.value = 'Others';
          optionother.textContent = 'Others';
          typeSelect.appendChild(optionother);
        } catch (error) {
          console.error("Error fetching and displaying vessel types:", error);
        }
      }
      const seaServiceID = urlParams.get("id");
      if(seaServiceID!=="") {
        checkingEdit()
      }
      function checkingEdit() {   
        if(companyList.length>0 && rankList.length>0 && vesselList.length>0 && vesselTypeList.length>0) {
          editSeaService(seaServiceID)
        }else {
          setTimeout(function () {
            checkingEdit();
          }, 500);
        }
      }

      $('body').on('change', '#from1, #to1', function() {
        console.log($('#from1').val(), $('#to1').val())
        var total_MMDD = '';
        var totalMMDD = calculateTotalMonth($('#from1').val(),$('#to1').val());
        if(totalMMDD!=="") {        
          if(parseInt(totalMMDD.totalMonths)>0) {
              total_MMDD+=`${totalMMDD.totalMonths} Month${parseInt(totalMMDD.totalMonths)>1?'s':''}`;
          }
          if(parseInt(totalMMDD.days)>0) {
              if(total_MMDD!=="") {
                  total_MMDD+=' ';
              }
              total_MMDD+=`${totalMMDD.days} Day${parseInt(totalMMDD.days)>1?'s':''}`;   
          }        
        }
        $('#total_MMDD').val(total_MMDD);
      });
      $('body').on('change', '#company', function() {
        if($(this).val()==='Others') {
          $('#othercompany').show();
        }else {
          $('#othercompany').hide();
        }
      });
      $('body').on('change', '#rank', function() {
        if($(this).val()==='Others') {
          $('#otherrank').show();
        }else {
          $('#otherrank').hide();
        }
      });
      $('body').on('change', '#vessel', function() {
        if($(this).val()==='Others') {
          $('#othervessel').show();
        }else {
          $('#othervessel').hide();
        }
      });
      $('body').on('change', '#type', function() {
        if($(this).val()==='Others') {
          $('#othervesseltype').show();
        }else {
          $('#othervesseltype').hide();
        }
      });
      
      

      function calculateTotalMonth (fromDate, toDate) {
    if(fromDate!=="" && toDate!=="") {
      var fromDate = new Date(fromDate);
      var toDate = new Date(toDate);
  
      if (fromDate && toDate && fromDate <= toDate) {
          var years = toDate.getFullYear() - fromDate.getFullYear();
          var months = toDate.getMonth() - fromDate.getMonth();
          var days = toDate.getDate() - fromDate.getDate();
  
          if (days < 0) {
              months--;
              var prevMonthDate = new Date(toDate.getFullYear(), toDate.getMonth(), 0); // Last day of the previous month
              days += prevMonthDate.getDate();
          }
  
          if (months < 0) {
              years--;
              months += 12;
          }
  
          var totalMonths = years * 12 + months;
          return {totalMonths:totalMonths, days:days}
      }
    }else {
      return "";
    }
  }

      async function fetchAndDisplaySeaService(candidateId) {
        try {
          const response = await axios.get(
            `${config.APIURL}candidate/get-sea-service/${candidateId}`,
            {
              headers: { Authorization: token },
            }
          );

          const seaServices = response.data;

          // Check if seaServices is an array
          if (Array.isArray(seaServices)) {
            const seaServiceList = document.getElementById("seaServiceList");
            seaServiceList.innerHTML = ""; // Clear existing data
            let index = 1;
            seaServices.forEach((seaService) => {
              const seaServiceRow = document.createElement("tr");
              seaServiceRow.id = `seaServiceRow-${seaService.id}`; // Assign a unique ID to each row
              seaServiceRow.innerHTML = `
                          <td>${index++}</td>
                          <td>${formatDateNew(seaService.from1)}</td>
                          <td>${formatDateNew(seaService.to1)}</td>
                          <td>${(seaService.company!==null)?seaService.company:''}</td>
                          <td>${(seaService.rank!==null)?seaService.rank:''}</td>
                          <td>${(seaService.vessel!==null)?seaService.vessel:''}</td>
                          <td>${(seaService.Flag!==null)?seaService.Flag:''}</td>
                          <td>${(seaService.KWT!==null)?seaService.KWT:''}</td>
                          <td>${(seaService.GRT!==null)?seaService.GRT:''}</td>
                          <td>${(seaService.DWT!==null)?seaService.DWT:''}</td>
                          <td>${(seaService.Engine!==null)?seaService.Engine:''}</td>
                          <td>${(seaService.type!==null)?seaService.type:''}</td>
                          <td>${(seaService.total_MMDD!==null)?seaService.total_MMDD:''}</td>
                          <td>${(seaService.reason_for_sign_off!==null)?seaService.reason_for_sign_off:''}</td>
                          <td>
                              <button class='btn btn-warning' onclick="editSeaService('${seaService.id}')">Edit</button>
                              <button class='btn btn-danger' onclick="deleteSeaService('${seaService.id}')">Delete</button>
                          </td>
                      `;
              seaServiceList.appendChild(seaServiceRow);
            });
          } else {
            console.error(
              "Sea service data is not in the expected format:",
              seaServices
            );
          }
        } catch (error) {
          console.error(
            "Error fetching and displaying sea service records:",
            error
          );
        }
      }

      async function deleteSeaService(id) {
        Swal.fire({
            title: 'Are you sure?',
            text: "Are you sure you want to delete this sea service record?",
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!',
            preConfirm: () => {
              Swal.showLoading();
              return new Promise((resolve, reject) => {
                setTimeout(() => {
                    // Resolve or reject based on your condition
                    resolve("Success");
                    // Or use reject("Error message") for failure
                }, 2000);
            }).catch(error => {
                Swal.showValidationMessage(`Error: ${error}`);
            });
          }
        }).then(async(result) => {
          if (result.value) {
            await axios.delete(
              `${config.APIURL}candidate/delete-sea-service/${id}`,
              { headers: { Authorization: token } }
            );
            Swal.fire({
                title: 'Done!',
                text: 'Deleted successful.',
                icon: 'success',
            });
            // Remove the corresponding row from the table
            const seaServiceRow = document.getElementById(
              `seaServiceRow-${id}`
            );
            seaServiceRow.remove();
          }
        })
      }
      function goBack() {
        // Get the search parameters from the URL
        const urlParams = new URLSearchParams(window.location.search);

        // Get the candidateId from the URL parameter
        const candidateId = urlParams.get("memId");

        if (candidateId) {
          // Construct the URL with candidateId as a query parameter
          const url = `./view-candidate.html?id=${candidateId}`;

          // Redirect to the new URL
          window.location.href = url;
        } else {
          console.error("Candidate ID not found in URL parameters");
        }
      }

      async function editSeaService(editID) {

        const response = await axios.get(`${config.APIURL}candidate/get-sea/${editID}`, { headers: { "Authorization": token } });
        console.log(response)
        const seaService = response.data?.editSea[0] || "";
        if(seaService!=="") {
          $('html, body').animate({
              scrollTop: $("#seaServiceForm").offset().top - 100
          }, 1000);

          $('#DWT').val(seaService.DWT);
          $('#Flag').val(seaService.Flag);
          $('#GRT').val(seaService.GRT);
          $('#KWT').val(seaService.KWT);
          $('#to1').val(seaService.to1);
          $('#from1').val(seaService.from1);
          $('#Engine').val(seaService.Engine);
          $('#total_MMDD').val(seaService.total_MMDD);
          $('#reason_for_sign_off').val(seaService.reason_for_sign_off)
          if(companyList.indexOf(seaService.company)>=0) {
            $('#company').val(seaService.company);
            $('#othercompany').hide()
          }else {
            $('#company').val('Others');
            $('#other_company').val(seaService.company);
            $('#othercompany').show()
          }

          if(rankList.indexOf(seaService.rank)>=0) {
            $('#rank').val(seaService.rank);
            $('#otherrank').hide()
          }else {
            $('#rank').val('Others');
            $('#other_rank').val(seaService.rank);
            $('#otherrank').show()
          }
          if(vesselList.indexOf(seaService.vessel)>=0) {
            $('#vessel').val(seaService.vessel);
            $('#othervessel').hide()
          }else {
            $('#vessel').val('Others');
            $('#other_vessel').val(seaService.vessel);
            $('#othervessel').show()
          }
          if(vesselList.indexOf(seaService.vessel)>=0) {
            $('#vessel').val(seaService.vessel);
            $('#othervessel').hide()
          }else {
            $('#vessel').val('Others');
            $('#other_vessel').val(seaService.vessel);
            $('#othervessel').show()
          }
          console.log(vesselTypeList, vesselTypeList.indexOf(seaService.type), seaService.type, 'seaService.type')
          if(vesselTypeList.indexOf(seaService.type)>=0) {
            $('#type').val(seaService.type);
            $('#othervesseltype').hide()
          }else {
            $('#type').val('Others');
            $('#other_vesseltype').val(seaService.type);
            $('#othervesseltype').show()
          }
          $('#editID').val(seaService.id)

          $(".select-dropdown").select2();
          if($('#seaServiceCollapse.collapse.show').length===0) {
            $('#seaServiceHeading button').trigger('click');
          }
          
        }
        console.log("edit response", seaService)

        // Open seaserviceedit.html in a new tab with the ID parameter
       // window.open(`seaserviceedit.html?memId=${id}&id=${editID}`, "_blank");
      }

      const createdBy = document.getElementById("createdBy");
      createdBy.value = decodedToken.userId;
      console.log(createdBy.value);

      const seaServiceForm = document.getElementById("seaServiceForm");

      seaServiceForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        var company = document.getElementById("company").value;
        if(company==='Others') {
          company = $('#other_company').val();
        }
        var rank = document.getElementById("rank").value
        if(rank==='Others') {
          rank = $('#other_rank').val();
        }
        var vessel = document.getElementById("vessel").value
        if(vessel==='Others') {
          vessel = $('#other_vessel').val();
        }
        var vesseltype =  document.getElementById("type").value;
        if(vesseltype==='Others') {
          vesseltype = $('#other_vesseltype').val();
        }
        const formData = {
          company: company,
          rank: rank,
          vessel: vessel,
          type: vesseltype,
          DWT: document.getElementById("DWT").value,
          Flag: document.getElementById("Flag").value,
          KWT: document.getElementById("KWT").value,
          GRT: document.getElementById("GRT").value,
          Engine: document.getElementById("Engine").value,
          from1: document.getElementById("from1").value,
          to1: document.getElementById("to1").value,
          total_MMDD: document.getElementById("total_MMDD").value,
          reason_for_sign_off: document.getElementById("reason_for_sign_off").value,
          createdBy: document.getElementById("createdBy").value,
        };
        try {
          const urlParams = new URLSearchParams(window.location.search);

          // Get the candidateId from the URL parameter
          const id = urlParams.get("memId");
          var editID = $('#editID').val();
         
          if(editID!=="") {
            var frmurl = `${config.APIURL}candidate/edit-sea-service/${editID}`
            
          }else {
            var frmurl = `${config.APIURL}candidate/sea-service/${id}`;
          }
          
          const response =  (editID!=="")?await axios.put(frmurl, formData, { headers: { "Authorization": token } }):await axios.post(frmurl, formData, { headers: { "Authorization": token } });
          console.log(response.status, 'dsadad')
          if(response.status===200 || response.status===201) {
            Swal.fire({
              icon: "success",
              title: "Success",
              text:(editID!=="")?"Sea Service record updated successfully!":"Sea Service record added successfully!",
            });
            seaServiceForm.reset();         
            $('#othercompany, #otherrank, #othervessel, #othervesseltype').hide();
            $('#seaServiceHeading button').trigger('click');
            $(".select-dropdown").select2();
            $('#editID').val('');
            fetchAndDisplaySeaService(id);
          }else {
            Swal.fire({
              icon: "error",
              title: "Error",
              text:"Error adding sea service record. Please try again.",
            });
          }
        } catch (error) {
          console.error("Error adding sea service record:", error);
          Swal.fire({
              icon: "error",
              title: "Error",
              text:"Error adding sea service record. Please try again.",
            });
        
        }
      });

      

      fetchAndDisplayCompanies();
      fetchAndDisplayRanks();
      fetchAndDisplayVessels();
      fetchAndDisplayVesselTypes();
    </script>
  </body>
</html>
