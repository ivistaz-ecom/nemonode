<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payslips</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2 class="mb-4">Payslips</h2>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Month</th>
                    <th>Year</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Days Worked</th>
                    <th>Amount</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="payslip-table-body">
                <!-- Payslip entries will be dynamically added here -->
            </tbody>
        </table>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- Custom Script -->
    <script>
document.addEventListener("DOMContentLoaded", function () {
    const urlParams = new URLSearchParams(window.location.search);
    const contractId = urlParams.get('contractId');

    if (!contractId) {
        console.error('Contract ID is missing in the URL');
        return;
    }

    axios.get(`https://nemo.ivistaz.co/candidate/get-payslips/${contractId}`)
        .then(response => {
            console.log(response.data); // Check the response structure
            populateTable(response.data.payslips); // Pass the correct data
        })
        .catch(error => {
            console.error('Error fetching payslips:', error);
        });
});

function populateTable(payslips) {
    const tableBody = document.getElementById('payslip-table-body');
    tableBody.innerHTML = ''; // Clear any existing rows

    payslips.forEach(payslip => {
        console.log(payslip)
        const row = document.createElement('tr');
        
        row.innerHTML = `
            <td>${payslip.month}</td>
            <td>${payslip.year}</td>
         
            <td>${new Date(payslip.startDate).toLocaleDateString()}</td>
            <td>${new Date(payslip.endDate).toLocaleDateString()}</td>
            <td>${payslip.daysWorked}</td>
            <td>${payslip.amount}</td>
            <td><button class="btn btn-primary" onclick="viewPayslip(${payslip.id})">View Payslip</button></td>
        `;
        
        tableBody.appendChild(row);
    });
}

function viewPayslip(id) {
    // Redirect to payslip details page or show a modal with payslip details
    window.location.href = `/payslip-details.html?id=${id}`;
}

    </script>
</body>
</html>
