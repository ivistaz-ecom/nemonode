<!DOCTYPE html>

<html
  lang="en"
  class="light-style layout-menu-fixed"
  dir="ltr"
  data-theme="theme-default"
  data-assets-path="../assets/"
  data-template="vertical-menu-template-free"
>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <style>
      .loader {
        --r1: 154%;
        --r2: 68.5%;
        width: 60px;
        aspect-ratio: 1;
        border-radius: 50%;
        background: radial-gradient(
            var(--r1) var(--r2) at top,
            #0000 79.5%,
            #269af2 80%
          ),
          radial-gradient(
            var(--r1) var(--r2) at bottom,
            #269af2 79.5%,
            #0000 80%
          ),
          radial-gradient(var(--r1) var(--r2) at top, #0000 79.5%, #269af2 80%),
          #ccc;
        background-size: 50.5% 220%;
        background-position: -100% 0%, 0% 0%, 100% 0%;
        background-repeat: no-repeat;
        animation: l9 1.4s linear forwards;
        animation-iteration-count: 1;
        animation-fill-mode: forwards;
      }

      @keyframes l9 {
        33% {
          background-position: 0% 33%, 100% 33%, 200% 33%;
        }
        66% {
          background-position: -100% 66%, 0% 66%, 100% 66%;
        }
        100% {
          background-position: 0% 100%, 100% 100%, 200% 100%;
        }
      }
    </style>
    <title>Manage Grade | Nsnemo</title>

    <meta name="description" content="" />
    <link rel="icon" type="image/x-icon" href="./fav-icon.ico" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Company - Nsnemo</title>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />

    <!-- Icons. Uncomment required icon fonts -->
    <link rel="stylesheet" href="../assets/vendor/fonts/boxicons.css" />

    <!-- Core CSS -->
    <link
      rel="stylesheet"
      href="../assets/vendor/css/core.css"
      class="template-customizer-core-css"
    />
    <link
      rel="stylesheet"
      href="../assets/vendor/css/theme-default.css"
      class="template-customizer-theme-css"
    />
    <link rel="stylesheet" href="../assets/css/demo.css" />

    <!-- Vendors CSS -->
    <link
      rel="stylesheet"
      href="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css"
    />

    <!-- Page CSS -->

    <!-- Helpers -->
    <script src="../assets/vendor/js/helpers.js"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="../assets/js/config.js"></script>
  </head>

  <body>
    <div id="logoutContent"></div>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->

        <aside
          id="layout-menu"
          class="layout-menu menu-vertical menu bg-menu-theme"
        >
          <div
            class="app-brand demo mt-0"
            style="
              background-color: #008e9c;
              padding-top: 70px;
              padding-bottom: 50px;
            "
            id="leftLogo"
          ></div>

          <ul class="menu-inner py-1 pt-3" id="menuList"></ul>
        </aside>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->

          <nav
            class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
            id="layout-navbar"
          ></nav>

          <!-- / Navbar -->

          <!-- Content wrapper -->
          <div class="container-fluid">
            <!-- <a href="./indexpage.html" class="btn btn-primary mt-3 mb-3"> Back to Dashboard</a> -->

            <div class="container-fluid card mt-3">
              <h4 class="ms-0 mt-3">Todays All Discussions</h4>

              <ul
                id="discussionList"
                class="list-group mt-3 border border-secondary-subtle mb-3"
              ></ul>
            </div>

            <script></script>

            <div class="container-fluid mt-3 card p-3">
              <h4 class="text-dark">Discussion Status</h4>
              <form id="statusForm">
                <div class="mb-3">
                  <label for="user_client" class="form-label"
                    >Company Name:</label
                  >
                  <select
                    id="user_client"
                    name="user_client"
                    class="form-select"
                    required
                  >
                    <option value="">Select Company</option>
                    <!-- Add options dynamically from your data -->
                  </select>
                </div>
                <div class="mb-3">
                  <label for="startDate" class="form-label">Start Date:</label>
                  <input
                    type="date"
                    id="startDate"
                    name="startDate"
                    class="form-control"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="endDate" class="form-label">End Date:</label>
                  <input
                    type="date"
                    id="endDate"
                    name="endDate"
                    class="form-control"
                    required
                  />
                </div>
                <button type="submit" class="btn btn-primary">
                  Get Status Data
                </button>
              </form>
            </div>

            <div id="statusResults" class="card p-3 mt-3 mb-3">
              <!-- Status Container -->
              <div class="status-container">
                <!-- Status Header -->
                <div class="status-header">
                  <h4 class="ms-4 mt-3 text-dark">Status</h4>
                </div>
                <!-- Discussion List -->
                <ul
                  class="list-group list-group-flush border rounded-3 border-secondary-subtle"
                >
                  <!-- Discussion Item -->
                  <!-- Add more discussion items here -->
                </ul>
              </div>
              <!-- Add more status containers here -->
            </div>
          </div>
          <footer
            class="footer mt-auto py-3 bg-footer-theme"
            id="footetcontent"
          ></footer>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
      </div>

      <!-- /Account -->
      <!-- / Content -->

      <!-- Footer -->
      <!-- / Footer -->

      <div class="content-backdrop fade"></div>
      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>
    </div>
    <!-- / Layout wrapper -->

    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->
    <script src="../assets/vendor/libs/jquery/jquery.js"></script>
    <script src="../assets/vendor/libs/popper/popper.js"></script>
    <script src="../assets/vendor/js/bootstrap.js"></script>
    <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>

    <script src="../assets/vendor/js/menu.js"></script>
    <!-- endbuild -->

    <!-- Vendors JS -->
    <script>
      let activeMenu = "dashboard";
      let activesub = "dashboard";
      let currentPage = "Status";
    </script>
    <script src="./menu.js"></script>

    <!-- Main JS -->
    <script src="../assets/js/main.js"></script>
    <!-- Page JS -->
    <script src="../assets/js/pages-account-settings-account.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>

    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>

    <script>
      document
        .getElementById("statusForm")
        .addEventListener("submit", async (event) => {
          event.preventDefault();

          const companyName = document.getElementById("user_client").value;
          const startDate = document.getElementById("startDate").value;
          const endDate = document.getElementById("endDate").value;

          const params = {
            companyName,
            startDate,
            endDate,
          };

          try {
            const response = await axios.get(
              `${config.APIURL}candidate/statusdate`,
              { params }
            );
            console.log(response);
            if (response.status === 200) {
              const data = response.data;
              insertData(data, decodedToken);
            } else {
              throw new Error("Failed to fetch status data");
            }
          } catch (error) {
            console.error("Error:", error.message);
          }
        });

      function insertData(data, decodedToken) {
        console.log(decodedToken);
        const statusResults = document.getElementById("statusResults");
        statusResults.innerHTML = "";

        for (const status in data) {
          const discussions = data[status];
          const statusContainer = document.createElement("div");
          statusContainer.classList.add("status-container");

          const statusHeader = document.createElement("div");
          statusHeader.classList.add(
            "status-header",
            "ms-4",
            "mt-3",
            "text-dark"
          );
          statusHeader.innerHTML = `<h4>${status}</h4><span class="badge bg-light text-primary">Total Count :  ${discussions.length}</span>`;
          statusContainer.appendChild(statusHeader);

          const table = document.createElement("table");
          table.classList.add("table");
          const tableHeader = document.createElement("thead");
          tableHeader.innerHTML = `
<tr>
<th scope="col">Candidate ID</th>
<th scope="col">Rank</th>
<th scope="col">Join Date</th>
<th scope="col">Reason</th>
</tr>
`;
          table.appendChild(tableHeader);

          const tableBody = document.createElement("tbody");
          discussions.forEach((discussion) => {
            const row = document.createElement("tr");
            row.innerHTML = `
<td><button class="candidate-btn text-primary btn" data-candidate-id="${
              discussion.candidateId
            }">${discussion.candidateId}</button></td>
<td>${discussion["Candidate.c_rank"]}</td>
<td>${formatDate(discussion.created_date)}</td>
<td>${discussion.reason}</td>
`;
            tableBody.appendChild(row);
          });
          table.appendChild(tableBody);

          statusContainer.appendChild(table);
          statusResults.appendChild(statusContainer);
        }

        // Add event listener to candidate ID buttons
        document.querySelectorAll(".candidate-btn").forEach((button) => {
          button.addEventListener("click", function () {
            const candidateId = this.getAttribute("data-candidate-id");
            viewCandidate(candidateId);
          });
        });
      }

      function exportToExcel(table, status) {
        const wb = XLSX.utils.table_to_book(table);
        XLSX.writeFile(wb, `${status}_data.xlsx`);
      }
      function viewCandidate(id) {
        // Add your view logic here
        window.open(`./view-candidate.html?id=${id}`, "_blank");
      }

      // Call insertData function to insert the example data
      async function createCompanyDropdown() {
        try {
          const companyResponse = await axios.get(
            `${config.APIURL}company/dropdown-company`,
            { headers: { Authorization: token } }
          );
          const companyOptions = companyResponse.data.companies; // Corrected property name
          const companyDropdown = document.getElementById("user_client");
          companyDropdown.innerHTML = ""; // Clear existing options

          // Add the default option
          const defaultOption = document.createElement("option");
          defaultOption.value = "";
          defaultOption.text = "-- Select Company --";
          companyDropdown.appendChild(defaultOption);

          // Add options for each company
          companyOptions.forEach((company) => {
            const option = document.createElement("option");
            option.value = company.company_id; // Set the value to company ID
            option.text = company.company_name;
            companyDropdown.appendChild(option);
          });
        } catch (error) {
          console.error("Error fetching company data:", error);
        }
      }

      document.addEventListener("DOMContentLoaded", async () => {
        fetchData();
        createCompanyDropdown();

        // Function to fetch discussion data
        async function fetchData() {
          try {
            const url = `${config.APIURL}candidate/statusdata`;
            const response = await axios.get(url);
            renderDiscussionData(response.data);
          } catch (error) {
            console.error("Error fetching discussion data:", error);
          }
        }

        // Function to render discussion data
        function renderDiscussionData(data) {
          const discussionList = document.getElementById("discussionList");
          discussionList.innerHTML = ""; // Clear existing items

          // Iterate over each status and render discussions for each status
          for (const status in data) {
            const discussions = data[status];
            console.log(status);

            discussions.forEach((discussion) => {
              // Render each discussion item
              const listItem = document.createElement("li");
              listItem.classList.add("list-group-item");
              listItem.innerHTML = `
                          <div class="d-flex justify-content-between">
                              <div>
                                  <h5 class="mb-1 d-flex align-items-center">Candidate ID: <button class="btn btn-link candidate-btn" data-candidate-id="${
                                    discussion.candidateId
                                  }">${discussion.candidateId}</button></h5>
                                  <p class="mb-1">Discussion: ${
                                    discussion.discussion
                                  }</p>
                              </div>
                              <div>
                                  <span class="${getBadgeColor(
                                    status
                                  )}">${status}</span>
                              </div>
                          </div>
                          <small class="text-muted">Reminder Date: ${
                            discussion.r_date
                          }</small>
                      `;
              discussionList.appendChild(listItem);

              // Add event listener to candidate ID button
              listItem
                .querySelector(".candidate-btn")
                .addEventListener("click", () => {
                  const candidateId = discussion.candidateId;
                  localStorage.setItem("memId", candidateId);
                  // Redirect to view-candidate page with candidateId
                  window.location.href = `view-candidate.html?id=${candidateId}`;
                });
            });
          }
        }

        // Function to determine badge color based on discussion status
        function getBadgeColor(status) {
          switch (status) {
            case "Proposed":
              return "badge bg-primary";
            case "Approved":
              return "badge bg-success";
            case "Joined":
              return "badge bg-info";
            case "Rejected":
              return "badge bg-danger";
            default:
              return "badge bg-secondary"; // Default badge color for unknown statuses
          }
        }
      });
      function formatDate(dateString) {
        const date = new Date(dateString);
        const formattedDate = date.toISOString().split("T")[0];
        return formattedDate;
      }
    </script>
  </body>
</html>
